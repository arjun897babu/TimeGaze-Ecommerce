<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimeGaze</title>
  <link rel="icon" href="image/android-chrome-512x512.png" type="image/png" alt="Site Icon">


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />

  <!-- boostrap css cdn link -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- bootstrap icon cdn link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">


  <!-- css style sheet link -->
  <link rel="stylesheet" href="css/header_footer.css">


  <style>
    .is-activeMobile {
      background-color: white;
      color: black !important;
      border: 2px solid;
    }

    .mobile-profile-navigaton .text-white {
      padding: 4px;
    }

    .mobile-profile-navigaton {
      display: none;
    }

    aside a {
      color: black;
    }

    @media (max-width:768px) {
      aside {
        display: none !important;
      }

      .mobile-profile-navigaton {
        display: block;
      }
    }

    aside li {
      text-align: center;
      padding: 0.5rem
    }

    .is-active {
      color: white;
      border: 2px solid;
      text-align: center;
      margin: 0;
      background: black;
    }

    .is-active span {
      color: white;
    }

    @media (min-width: 576px) {

      #section-last h3 {
        font-size: 1.3rem;
        text-transform: capitalize;
      }
    }

    .form-control:focus .accordian-button:focus {
      color: var(--bs-body-color);
      background-color: var(--bs-body-bg);
      border-color: none;
      outline: 0;
      box-shadow: none;
    }


    .breadcrumb-item a {
      color: rgb(0, 0, 0) !important;
      font-size: inherit;
    }
  </style>

</head>

<body>
  <%- include('../include/headerCommon') %>



    </div>


    </header>
    <!-- header -->
    <div class="container-fluid">
      <nav aria-label="breadcrumb " class="p-4">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">Profile</li>
        </ol>
      </nav>
    </div>

    <section class="container-fluid my-3">
      <div class="row">
        <aside class="col-md-3 p-2 bg-light-subtle">
          <div>
            <ul class="flex-column d-flex ">
              <li>
                <h4>Your account</h4>
              </li>
              <li class="">
                <a href="/profile">
                  <span class="text ">Profile</span>
                </a>
              </li>

              <li class="is-active ">
                <a href="/address">

                  <span class="text">address</span>
                </a>
              </li>
              <li class="">
                <a href="/orderHistory">
                  <span class="text">orders</span>

                </a>
              </li>
              <li>
                <!-- <form action="/logout" method="post" class="py3 d-flex align-items-center justify-content-center">
                  <i class="bi bi-arrow-return-left text-danger"></i>
                  <button type="submit" class="btn "><span class="text-danger">LOG OUT</span></button>
                </form> -->
              </li>
            </ul>

          </div>

        </aside>
        <div class="mobile-profile-navigaton">
          <div class="col-12 d-flex   container-fluid justify-content-evenly bg-dark mb-3">
            <a href="/profile">
              <div class="text-white">Profile</div>
            </a>
            <a href="/address">
              <div class="text-white is-activeMobile ">address</div>
            </a>
            <a href="">
              <div class="text-white ">orders</div>
            </a>


          </div>
        </div>

        <div class="col-md-9">

          <div class="container">
            <div class="accordion  my-5" id="addAdress">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button rounded-0" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Add adress
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#addAdress">
                  <div class="accordion-body">
                    <form action="/api/createAdress" method="post" class="requires-validation" novalidate>
                      <div class="row p-2">

                        <div class="col-md-6">
                          <label for="validateName" class="form-label"> name</label>
                          <input type="text" class="form-control " name='name' id="validateName">
                          <small class="text-danger"></small>
                        </div>

                        <div class="col-md-6">
                          <label for="validateMobileNumber" class="form-label"> mobileNumber</label>
                          <input type="number" name="mobileNumber" class="form-control " id="validateMobileNumber">
                          <small class="text-danger"></small>
                        </div>

                        <div class="col-md-4">
                          <!-- <label for="validateOffer" class="form-label">state</label>
                          <input type="text" name="state" class="form-control " id="validateOffer">
                        -->
                          <label for="state" class="form-label">State</label>
                          <select class="form-select" name="state" id="state">
                            <option value="" disabled selected>Select state</option>
                            <% for(x of allStates) {%>
                              <option value="<%=x.name  %>">
                                <%=x.name %>
                              </option>
                              <% } %>
                          </select>

                          <small class="text-danger"></small>

                        </div>

                        <div class="col-md-4">
                          <label for="district" class="form-label">district</label>
                          <select class="form-select" name="district" id="district">
                            <option value="" disabled selected>Select district</option>
                           
                          </select>
                          <!--                           
                          <label for="inputAddress" class="form-label">District</label>
                          <input type="text" name="district" class="form-control " id="validateCaseDiameter"> -->
                          <small class="text-danger"></small>

                        </div>
                        <div class="col-md-4">
                          <label for="locality" class="form-label">Locality</label>
                          <input type="text" name="locality" class="form-control " id="locality">
                          <small class="text-danger"></small>
                        </div>


                        <div class="col-md-12">
                          <div class="row">
                            <div class="col-md-12">
                              <label for="validateAdress" class="form-label">Address</label>
                              <textarea class="form-control " name="address" id="validateAdress" rows="4"
                                placeholder="adress(area and street)"></textarea>
                              <small class="text-danger"></small>
                            </div>
                          </div>

                        </div>
                        <div class="col-md-12">
                          <div class="col-5">
                            <label for="validateCaseShape" class="form-label">Pincode</label>
                            <input type="number" name="pincode" class="form-control " id="validateCaseShape">
                            <small class="text-danger"></small>
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div class="col-2 d-flex flex-column ">
                            <label class="form-label">AdressType</label>
                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                              <input type="radio" name="addressType" class="btn-check" id="home" autocomplete="off"
                                value="Home">
                              <label class="btn btn-outline-dark" for="home">Home</label>

                              <input type="radio" name="addressType" class="btn-check" id="office" autocomplete="off"
                                value="Office">
                              <label class="btn btn-outline-dark" for="office">Office</label>
                            </div>
                            <small class="text-danger"></small>
                          </div>
                        </div>
                      </div>


                      <div class="d-flex justify-content-center mt-3">
                        <button type="submit" class="btn btn-outline-dark col-6">Add adress</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <% if(address.length>0){ %>
            <% address.forEach(function (element,index) { %>
              <div class="container">

                <div class="container-fluid">

                  <div class="row border mb-3">
                    <div class="col-md-9 p-1">
                      <div class="d-flex ">
                        <%if (element.address.defaultAdress) {%>
                          <div class="d-flex justify-content-between align-items-center">
                            <input type="radio" name="defaultAdress" id="defaultAdress" class="ms-2 defaultAddress"
                              data-id="<%=element._id  %>" value="<%=element.address._id %>"
                              <%=(element.address.defaultAdress)?'checked':''%>>
                            <!-- <label for="defaultAdress" class="ms-1">Default</label> -->
                          </div>
                          <% } %>

                            <div class=" ms-5 d-flex flex-column">
                              <div class="d-flex align-content-center">
                                <span class=" me-3 m-0">
                                  <%= element.address.name%>
                                </span>
                                <span class="me-3 bg-secondary-subtle">
                                  <%= element.address.addressType%>
                                </span>
                                <span>
                                  <%= element.address.mobileNumber%>
                                </span>
                              </div>
                              <address style="font-size: 0.8rem;white-space: nowrap;
                          overflow: hidden;
                          text-overflow: ellipsis;
                          max-width: 220px;">
                                <%= element.address.address%>
                              </address>
                            </div>


                      </div>

                    </div>
                    <div class="col-md-3 d-flex align-items-center justify-content-md-end gap-2">
                      <a href="/editAddress?selected=<%= element.address._id%>" class="btn btn-outine-dark"
                        value="<%= element.address._id%>" data-id="<%=element._id  %>">
                        <i class="bi bi-pencil-fill"></i>
                      </a>

                      <button class="btn btn-dark delete-address" value="<%= element.address._id%>"
                        data-id="<%=element._id  %>"> <i class="bi bi-trash3-fill"></i></button>

                    </div>
                  </div>
                </div>
              </div>
              <% }); %>
                <% } %>
        </div>

      </div>
    </section>

    <!-- footer -->
    <%- include('../include/footer') %>
      <!-- footer -->

      <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
      <script src="js/togglebutton.js"></script>
      <script src="/js/userAddAdress.js"></script>
      <script src="js/deleteAddress.js"></script>
      <script>

        $("#state").on("change", function () {
          var selectedState = $(this).val();
          fetchCities(selectedState);
        });

        function fetchCities(selectedState) {
          $.ajax({
            url: "https://countriesnow.space/api/v0.1/countries/state/cities",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
              country: "India",
              state: selectedState
            }),
            success: function (response) {

              var districtDropdown = $("#district");
              districtDropdown.empty();
              districtDropdown.append('<option value="" disabled selected>Select district</option>');
              for (let city of response.data) {
                districtDropdown.append(`<option value="${city}">${city}</option>`);
              }
            },
            error: function (error) {
              console.error("Error fetching cities:", error);
            }
          });
        }
      </script>
</body>

</html>