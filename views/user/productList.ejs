<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimeGaze</title>
  <link rel="icon" href="/image/android-chrome-512x512.png" type="image/png" alt="Site Icon">

  <!-- boostrap css cdn link -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- bootstrap icon cdn link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">

  <!-- css style sheet link -->
  <link rel="stylesheet" href="/css/header_footer.css">


  <style>
    .product-card {
      background-color: #EFEFEF;
      border-radius: 0.8rem;
    }

    .product-card span {
      position: absolute;
      right: 1rem;
      top: 1rem;
    }

    @media (min-width: 576px) {

      #section-last h3 {
        font-size: 1.3rem;
        text-transform: capitalize;
      }
    }

    .form-control:focus {
      color: var(--bs-body-color);
      background-color: var(--bs-body-bg);
      border-color: none;
      outline: 0;
      box-shadow: none;
    }

    .product-card {
      width: 357px;
      height: 455px;
      margin: 10px;
    }

    .product-card img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }

    .breadcrumb-item a {
      color: rgb(0, 0, 0) !important;
      font-size: inherit;
    }

    .page-link {
      color: black;
    }

    .active>.page-link,
    .page-link.active {
      background-color: black !important;
      border-color: azure !important;
    }

    @media (max-width: 320px) {
      .small-col {
        width: 100%;
        /* Set the width to 100% for screens less than 320px */
      }
    }
  </style>

</head>

<body>
  <!-- header -->
  <%- include('../include/headerCommon') %>
    </header>
    <!-- header -->


    <nav aria-label="breadcrumb " class="p-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/" class="">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">
          <%=categories[x].categoryName%>
        </li>
      </ol>
    </nav>


    <!-- section -->
    <!--Main Navigation-->


    <!-- sidebar + content -->
    <section class="">
      <div class="container-fluid">
        <div class="row">
          <!-- sidebar -->
          <div class="col-md-4 col-lg-3">
            <!-- Toggle button -->
            <button class="btn btn-outline-secondary mb-3 w-100 d-md-none" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
              aria-label="Toggle navigation">
              <span>Show filter</span>
            </button>
            <!-- Collapsible wrapper -->
            <div class="collapse card d-md-block mb-5" id="navbarSupportedContent">
              <div class="accordion" id="accordionPanelsStayOpenExample">
                <form action="" id="filterForm">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                      <button class="accordion-button text-dark bg-light" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseThree">
                        Price
                      </button>
                    </h2>
                    <!-- <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse show"
                      aria-labelledby="headingThree">
                      <div class="accordion-body">
                        <div class="row mb-3">
                          <div class="col-6">
                            <p class="mb-0">
                              Min
                            </p>
                            <div class="form-outline">
                              <input type="number" id="typeNumber" class="form-control" />
                              <label class="form-label" for="typeNumber">₹0</label>
                            </div>
                          </div>
                          <div class="col-6">
                            <p class="mb-0">
                              Max
                            </p>
                            <div class="form-outline">
                              <input type="number" id="typeNumber" class="form-control" />
                              <label class="form-label" for="typeNumber">₹1,00000</label>
                            </div>
                          </div>
                        </div>
                        <button type="button" class="btn btn-white w-100 border border-secondary">apply</button>
                      </div>
                    </div> -->
                  </div>
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                      <button class="accordion-button text-dark bg-light" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseOne">
                        categories
                      </button>
                    </h2>
                    <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show"
                      aria-labelledby="headingOne">
                      <div class="accordion-body">
                        <% for(x of categories) {%>
                          <% const decodedString=decodeURIComponent(totalPages.path); %>
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" name="category"
                                value="<%=x.categoryName %>" id="<%=x.categoryName  %>"
                                <%=(selected.category && selected.category.some(cat => cat.toLowerCase() === x.categoryName.toLowerCase())) ? ' checked' : '' %> />

                              <label class="form-check-label" for="">
                                <%=x.categoryName %>
                              </label>
                              <span class="badge badge-secondary float-end">120</span>
                            </div>
                            <% } %>
                      </div>
                    </div>

                  </div>
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                      <button class="accordion-button text-dark bg-light" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseTwo">
                        Brands
                      </button>
                    </h2>
                    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse show "
                      aria-labelledby="headingTwo">
                      <div class="accordion-body">
                        <div>
                          <div><%= selected.brands %></div>
                          <% for(brandName of brands) {%>
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" name="brand" value="<%=brandName %>"
                                id="flexCheckChecked1"   <%=(selected.brands && selected.brands.some(b => b.toLowerCase() === brandName.toLowerCase())) ? ' checked' : '' %> />
                              <label class="form-check-label" for="">
                                <%=brandName %>
                              </label>
                              <span class="badge badge-secondary float-end">120</span>
                            </div>
                            <% } %>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                      <button class="accordion-button text-dark bg-light" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseFour">
                        case diameter
                      </button>
                    </h2>
                    <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse show"
                      aria-labelledby="headingThree">
                      <div class="accordion-body">
                        <% for(caseDiameter of caseDiameters) {%>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="caseDiameter" value="<%=caseDiameter %>" id="<%=caseDiameter %>"  <%=(selected.caseDiameter&&selected.caseDiameter.includes(caseDiameter.toString()))? 'checked' : '' %>  />
                            <label class="form-check-label" for="<%=caseDiameter %>">
                              <%=caseDiameter %> <small>mm</small>
                            </label>
                            <span class="badge badge-secondary float-end">120</span>
                          </div>
                          <% } %>
                      </div>
                    </div>

                  </div>

                </form>
                <!-- <div class="accordion-item">
                  <h2 class="accordion-header" id="headingThree">
                    <button class="accordion-button text-dark bg-light" type="button" data-bs-toggle="collapse"
                      data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="false"
                      aria-controls="panelsStayOpen-collapseFive">
                      Ratings
                    </button>
                  </h2>
                  <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse show"
                    aria-labelledby="headingThree">
                    <div class="accordion-body">
                      
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
                        <label class="form-check-label" for="flexCheckDefault">
                          <i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i
                            class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i>
                          <i class="bi bi-star-fill text-warning"></i>
                        </label>
                      </div>
                      
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
                        <label class="form-check-label" for="flexCheckDefault">
                          <i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i
                            class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i>
                          <i class="bi bi-star-fill text-secondary"></i>
                        </label>
                      </div>
                      
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
                        <label class="form-check-label" for="flexCheckDefault">
                          <i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i
                            class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-secondary"></i>
                          <i class="bi bi-star-fill text-secondary"></i>
                        </label>
                      </div>
                      Default checkbox
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
                        <label class="form-check-label" for="flexCheckDefault">
                          <i class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i
                            class="bi bi-star-fill text-secondary"></i><i class="bi bi-star-fill text-secondary"></i>
                          <i class="bi bi-star-fill text-secondary"></i>
                        </label>
                      </div>
                    </div>
                  </div>
                </div> -->
              </div>
            </div>
          </div>
          <!-- sidebar -->
          <!-- content -->
          <div class="col-md-8 col-lg-9">

            <div class="row">
              <% if(products==false) { %>
                <div class="text-center">
                  \(^Д^)/
                  No Products.
                </div>
                <% } else { %>
                  <% for( i=0;i<products.length;i++) { %>

                    <div class="justify-content-center col-6 col-sm-3 d-flex small-col">

                      <div class="card m-2" style="width: 13rem;">
                        <i class="card-img-top d-flex justify-content-end pe-2"><i class="bi bi-heart"></i></i>
                        <a href="/singleProduct?pid=<%=products[i]._id%>&product=<%=products[i].productName%>"><img
                            src="/uploads/<%=products[i].image[0]%>" class=""
                            style="object-fit:cover;width: 100%; height: 100%" alt="...">

                        </a>
                        <div class="card-body p-0">
                          <h5 class="card-title m-1" style="font-size: 0.8rem; text-transform: capitalize;">
                            <%=products[i].productName%> 
                          </h5>
                          <p><%=products[i].brand%></p>
                          <p class="card-text m-1 ps-1">₹<%=products[i].discountPrice%> <del class="text-black-50">₹<%=products[i].price%></del>
                          </p>
                        </div>
                        <div class=" ps-3 pe-3">
                        </div>
                      </div>
                    </div>
                    <% } %>

                      <hr />

                      <!-- Pagination -->
                      <nav aria-label="Page navigation example" class="d-flex justify-content-center mt-3">
                        <ul class="pagination">

                          <% for (let i=1; i <=totalPages.totalPages; i++) { %>
                            <% if(totalPages.totalPages>1) {%>
                              <li class="page-item <%= i.toString() == totalPages.pageNumber ? 'active' : '' %>">
                                <a class="page-link"
                                  href="/productList?<%= totalPages.path.replace(/(pageNumber=)[^&]*/, 'pageNumber=' + i) %>">
                                  <%= i %>
                                </a>

                                <% } %>
                                  <% } %>
                              </li>

                        </ul>
                      </nav>
                      <!-- Pagination -->
                      <% } %>
            </div>
          </div>
        </div>
    </section>
    <!-- sidebar + content -->

    <!-- section -->


    <%- include("../include/footer") %>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        let checkboxes = document.querySelectorAll('input[type="checkbox"]');
        let checkedValues = {};

        checkboxes.forEach(function (checkbox) {
          checkbox.addEventListener('change', function () {
            checkedValues = {};
            checkboxes.forEach(function (checkbox) {
              if (checkbox.checked) {
                let name = checkbox.name;
                let value = checkbox.value;
               

                if (checkedValues[name]) {
                  checkedValues[name].push(value);
                } else {
                  checkedValues[name] = [value];
                }
              }
            });
            console.log(checkedValues);
            let queryString = new URLSearchParams(checkedValues).toString();
            window.location.href = '/productList?'+queryString
          });
        });
      });

    </script>
      <script src="/js/togglebutton.js"></script>
</body>

</html>